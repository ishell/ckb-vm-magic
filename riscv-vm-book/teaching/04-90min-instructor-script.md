# 90 分钟授课脚本（讲师版）

## 一针见血目标

90 分钟课程不是“把 11 章缩读一遍”，而是让学员在一次课内建立一个可执行判断框架：

- 什么是共识 VM 的硬约束；
- 为什么 Rust 与 RISC-V 在此问题上形成工程合力；
- 如何用证据链评估一次优化是否可发布。

## 1. 课前准备（T-15 分钟）

讲师在开讲前完成以下检查：

1. 打开主文第 1、4、8、10、11 章对应页面。
2. 打开图示长文 `1-1`、`8-1`、`10-1`。
3. 终端预跑 `run_labs.sh --batch 1 --mode smoke --skip-asm`。
4. 准备两份日志：一份通过样本，一份失败样本（用于讲失败语义）。
5. 确认投影可显示代码锚点路径（`src/` 与 `tests/`）。

## 2. 时间编排总览（90 分钟）

| 时间段 | 模块 | 目标产出 |
|---|---|---|
| 0-10 | 开场与问题定义 | 学员能复述“共识约束优先” |
| 10-25 | 图 1-1 深挖：约束层级 | 学员能区分语义/计费/边界/优化 |
| 25-40 | 执行主线与状态机 | 学员能描述 run -> pause -> exit |
| 40-55 | 内存权限与 syscall 边界 | 学员能说明 W^X 与宿主边界含义 |
| 55-70 | Rust + ASM 协同机制 | 学员能说明为何必须保留 Rust 语义锚点 |
| 70-82 | RISC-V 与密码学负载映射 | 学员能解释 B/M/A/MOP 的分工 |
| 82-88 | 现场 demo 与失败复盘 | 学员能根据日志定位失败层级 |
| 88-90 | 收束与布置作业 | 学员写出 1 条架构结论 |

## 3. 分段讲稿（逐分钟）

### 3.1 0-10 分钟：开场

讲师台词建议：

- “今天我们不讨论 TPS 宣传词，只讨论可被审计的共识执行。”
- “任何优化都要先回答：是否改变可验证语义。”

板书三问：

1. 这个改动改变了什么语义？
2. 这个改动改变了多少计费结构？
3. 这个改动把风险转移给了谁？

课堂动作：

- 先投屏 `图 1-1` 对应长文封面，不急于讲代码。
- 让学员写下自己认为“最容易被忽略的一层约束”。

### 3.2 10-25 分钟：图 1-1 约束层级

讲解顺序固定为：

1. 语义正确性（同输入同状态同输出）。
2. 资源计费可解释（cycles 不是黑箱参数）。
3. 宿主边界可审计（syscall 白名单、内存权限）。
4. 性能优化可回滚（快路径不是不可逆投资）。

关键强调：

- 不允许把性能层结论反向覆盖语义层结论。
- “平均性能提升”不能掩盖长尾失败模式。

互动问题：

- 如果某优化让平均 cycles 降低 15%，但错误码语义发生漂移，是否可上线？为什么？

### 3.3 25-40 分钟：run -> exit 生命周期

使用图 2-1 和图 4-1 串讲：

- `run()` 入口不是黑盒，它会反复进入 fetch/decode/execute。
- `pause` 与 `exit` 是两种语义不同的终止状态。
- fast path 失败后回落 slow path 是“语义保险丝”，不是性能失败。

演示建议：

- 展示一条触发 `pause` 的测试输出，强调“可恢复执行”与“终止执行”不同。

### 3.4 40-55 分钟：内存权限与 syscall

核心结论：

- ELF 装载是权限系统初始化，不是普通 IO。
- `ecall` 分发是最小可信计算基入口。

讲师动作：

1. 展示页权限变化示意（R/W/X 的阶段变化）。
2. 展示“只保留最小 syscall 集”带来的好处：面缩小、审计成本可控。

一针见血提醒：

- 在共识 VM 里，“功能丰富”常常意味着“攻击面扩张”。

### 3.5 55-70 分钟：Rust + ASM 协同

讲法：先讲原则，再讲实现。

原则：

- Rust 提供可验证语义主线。
- ASM 提供热点路径性能。
- 二者通过统一入口/退出约定连接。

实现关注点：

- register 状态镜像一致性；
- 错误码与 PC 语义一致性；
- fallback 路径必须可测。

课堂问题：

- 如果 asm 后端快路径遗漏某个边界检查，最先暴露在哪类测试里？

### 3.6 70-82 分钟：RISC-V 与密码学扩展分工

讲解框架：

- RISC-V 的价值是治理可分层，不是“天然更快”。
- 密码学负载拆分必须遵守“算法层 -> 指令层 -> VM 层 -> 计费层”闭环。

推荐强调：

- B/M/A/MOP 的分工是工程化结果，不是教科书预设。
- 指令扩展引入要同时满足：兼容、计费、回滚、观测。

### 3.7 82-88 分钟：现场 demo 与失败复盘

建议命令：

```bash
bash docs/riscv-vm-book/tools/run_labs.sh --batch 1 --mode smoke --skip-asm
```

讲师要做的不是“展示通过”，而是：

1. 指出每条 case 的语义目标；
2. 打开一条日志解释失败定位路径；
3. 演示如何把日志信息写入审计模板（附录 F）。

### 3.8 88-90 分钟：收束

让每位学员现场写一句话：

“如果我要批准一个 VM 优化上线，我最先检查 ________，因为 ________。”

讲师收尾语：

- “没有证据链的性能结论，在共识系统里等于没有结论。”

## 4. 讲师易错点清单

1. 只讲抽象原则，不给代码锚点。
2. 只展示成功日志，不展示失败样本。
3. 把 RISC-V 讲成营销标签，而非治理机制。
4. 把 Rust 讲成“语法偏好”，而非安全与可审计手段。

## 5. 课后作业（与练习题联动）

- 基础班：完成 `teaching/02-exercises.md` 的 A/B 组。
- 工程班：追加 C 组实操并提交日志归档。
- 高阶班：完成 D 组治理题并给出门禁指标阈值。

## 6. 成功判据

课程结束后，至少 70% 学员应达到：

1. 能正确描述四层约束先后关系；
2. 能解释一个失败日志对应的风险层级；
3. 能说出“Rust + RISC-V”在共识 VM 里的非口号化理由。
