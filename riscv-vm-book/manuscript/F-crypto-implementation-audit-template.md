# 附录 F 密码学实现审计模板（PR 直用版）

> 用途：用于审查任何引入或修改密码学实现（签名、哈希、Merkle、大整数）的 PR。  
> 结论必须可复现、可对拍、可回滚。

## F.1 PR 基本信息

- PR 标题：
- PR 链接：
- 负责人：
- 审计人：
- 目标模块：
- 关联 issue/RFC：
- 影响范围（合约/VM/宿主）：

## F.2 变更分类（必选）

- [ ] 新增算法实现
- [ ] 现有算法重构
- [ ] 性能优化（无语义变更）
- [ ] 指令映射调整（如 MOP/B 扩展路径）
- [ ] 计费模型调整（cycles/gas）
- [ ] 汇编快路径变更

## F.3 威胁模型与安全目标

### F.3.1 资产

- 需要保护的秘密数据：
- 需要保证的一致性状态：

### F.3.2 攻击面

- [ ] 输入构造攻击
- [ ] 计费绕过/DoS
- [ ] 侧信道（时序/访存）
- [ ] 多后端语义漂移
- [ ] 宿主边界滥用

### F.3.3 安全目标

- [ ] 功能正确性
- [ ] 共识确定性
- [ ] 计费公平性
- [ ] 恒时约束（如适用）

## F.4 规范一致性检查

- 参考规范文档：
- 关键边界行为（除零/溢出/无效输入）说明：
- 与既有实现兼容性说明：

检查项：

- [ ] 边界条件均有测试向量
- [ ] 与规范语义逐条映射
- [ ] 无未定义行为依赖

## F.5 共识一致性检查

### F.5.1 跨后端对拍

- 后端矩阵：`rust-trace` / `asm`
- 对拍范围：
- 结果：

### F.5.2 跨平台对拍（如可用）

- 平台矩阵：
- 结果：

检查项：

- [ ] 相同输入 -> 相同输出
- [ ] 相同输入 -> 相同错误码
- [ ] 相同输入 -> 相同关键状态（寄存器/内存）

## F.6 恒时与侧信道检查（密码学必看）

- secret-dependent 分支评估：
- secret-dependent 访存评估：
- 汇编路径是否保持恒时约束：

检查项：

- [ ] 无基于秘密的分支路径差异
- [ ] 无基于秘密的内存访问模式差异
- [ ] 性能优化未破坏恒时约束

## F.7 内存与权限模型检查

- 是否触及 `WXorXMemory` 边界：
- 是否新增页权限转换：
- 是否新增 unsafe 或指针操作：

检查项：

- [ ] 无写可执行页行为
- [ ] 越界路径有明确错误返回
- [ ] unsafe 代码有最小化与注释说明

## F.8 计费与经济安全检查

- cycles 变化摘要：
- 代表性 workload：
- 校准方法：

检查项：

- [ ] 提供前后对比基线
- [ ] 热点负载费用变化可解释
- [ ] 无明显低成本高计算窗口

## F.9 测试与验证证据

### F.9.1 必要测试

- [ ] 单元测试
- [ ] 属性测试（proptest/fuzz）
- [ ] 回归测试
- [ ] 差分测试
- [ ] 代表性 workload 基准

### F.9.2 产物链接

- 测试报告：
- 对拍报告：
- 基准报告：

## F.10 代码审查重点（逐项结论）

1. 正确性结论：
2. 一致性结论：
3. 计费结论：
4. 侧信道结论：
5. 可维护性结论：

## F.11 发布门禁

- [ ] 通过语义门禁（正确 + 一致）
- [ ] 通过经济门禁（计费 + DoS）
- [ ] 通过安全门禁（侧信道 + 边界）
- [ ] 通过回滚门禁（可撤回 + 可恢复）

发布建议：

- [ ] 可发布
- [ ] 有条件发布（需补充）
- [ ] 拒绝发布

## F.12 审计签署

- 负责人签名：
- 审计人签名：
- 日期：

## F.13 一针见血结论

密码学 PR 的“通过标准”不是跑得快，而是：语义不漂移、计费不失真、安全边界不退化。

