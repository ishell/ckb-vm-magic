# 附录 I 端到端案例：哈希与 Merkle 验证执行解剖

## I.1 目的

本附录聚焦“哈希 + Merkle”这类链上常见验证路径，给出工程化执行解剖。

## I.2 场景设定

典型交易验证会包含：

1. 对输入片段做哈希轮函数计算
2. 按路径节点迭代做 Merkle 根重建
3. 对比目标根并返回验证结果

## I.3 指令级特征

相比 secp，哈希/Merkle 路径更偏向：

- 位操作密集（rotate/xor/shift）
- 小块数据搬运频繁
- 循环体结构稳定

因此 B 扩展与 Trace 机制对这类路径通常更敏感。

## I.4 成本行为特点

常见成本画像：

- opcode 类型集中，长尾较短
- syscall 比重通常低，算术与访存占主导
- cycles 对输入长度近似线性，但受内存布局影响

## I.5 关键优化点

1. 减少无谓拷贝：优先优化数据布局
2. 提升循环命中：稳定 basic block 结构
3. 控制边界检查开销：避免重复无效检查

## I.6 风险点

- 计费模型低估小块高频路径
- 汇编快路径与解释路径在边界轮次不一致
- 大输入时栈/内存边界处理错误

## I.7 实验建议

- 输入规模从小到大做分层采样
- 对比不同后端的 cycles 曲线
- 抽样检查 trace 命中率与 cache 退化点

## I.8 与主文映射

- 解码与 trace：第 4 章
- 密码学与扩展：第 10 章
- 计费与治理：第 11 章

## I.9 一针见血结论

哈希/Merkle 路径优化的核心不是“更快指令”，而是“更稳定的数据与控制流结构”。

