# 图 C-1 长文：ISA 到协议治理链，扩展引入如何避免“技术正确、治理失败”

## 摘要

图 C-1 描述的是“技术决策如何转化为治理后果”。在区块链 VM 中，新扩展引入失败往往不是因为指令本身错误，而是因为缺少版本门禁、回滚路径与计费校准。

## 1. 原图重述

```text
ISA semantics
  -> decoder/loader complexity
  -> multi-backend consistency
  -> tooling/audit cost
  -> protocol upgrade governance
```

结论：扩展引入是协议治理事件，不是单次代码提交。

## 2. 三重门禁模型

建议把扩展引入分为三重门禁：

1. 语义门禁：边界行为定义完整，测试向量完备
2. 经济门禁：计费模型可校准且无明显套利窗口
3. 治理门禁：灰度方案、监控指标、回滚预案齐备

三门缺一，均不应上线。

## 3. 向量扩展（V）引入示例路线

1. 先定义子集与禁用项（规范阶段）
2. 先落 Rust 语义实现（可审计）
3. 再做 ASM 热点加速（可控）
4. 再做费用校准与灰度发布（可回滚）

这个顺序本质上是“语义先于性能”。

## 4. 典型失败模式

### 失败模式 A：先上快路径再补规范

结果：实现先行，语义后补，差分 bug 高发。

### 失败模式 B：只做性能验证不做费用验证

结果：出现计费偏差和经济性漏洞。

### 失败模式 C：发布无回滚预案

结果：线上异常只能硬扛，治理成本陡增。

## 5. 审计资产最小包

每个扩展提案至少应附：

1. 语义说明书
2. 解码与执行实现说明
3. 计费模型与校准报告
4. 多后端差分报告
5. 回滚与兼容策略

这五项构成“可治理上线”的最小资产。

## 6. 组织协作建议

- 协议团队负责门禁定义
- 执行团队负责语义与实现
- 安全团队负责边界审计
- 运维团队负责灰度与回滚演练

若职责不分，扩展引入会反复在上线期集中爆雷。

## 7. 与主文映射

- 对应附录：`附录 C`
- 关键代码：`src/decoder.rs`, `src/machine/mod.rs`, `build.rs`
- 关联附录：`附录 E`, `附录 G`

## 8. 一针见血结论

扩展引入的成败，不取决于“指令是否可实现”，而取决于“是否可治理”。

